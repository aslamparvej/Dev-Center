<%- include('../includes/head', {webTitle: 'Blogs' }) %>
<%- include('../includes/header', { active: 'blogs' }) %>
<main>
  <section class="hero">
    <div class="container">
      <div class="hero-content">
        <h1>Latest Articles</h1>
        <p>Discover cutting-edge insights, tutorials, and AI-Enhanced content that will elevate your
          software development skills and keep you ahead of the curve.</p>
        <div class="stats-bar">
          <div class="stat-item">
            <span><i class="fa-regular fa-newspaper"></i> <strong><%= blogs.length - 1 %>+</strong> Articles Published</span>
          </div>
          <div class="stat-item">
            <span><i class="fa-solid fa-robot"></i> <strong>100%</strong> AI-Enhanced Content</span>
          </div>
          <div class="stat-item">
            <span><i class="fa-solid fa-star"></i> <strong>95%</strong> Accuracy Rate</span>
          </div>
          <div class="stat-item">
            <span><i class="fa-solid fa-rotate"></i> <strong>Daily</strong> Updates</span>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section class="filters-section">
    <div class="container">
      <div class="filters-container">
        <div class="search-bar">
          <input type="text" placeholder="Search articles..." id="search_articles_input" />
          <span class="search-bar__icon"><i class="fa-solid fa-magnifying-glass"></i></span>
        </div>
        <div class="filter-tags">
          <div class="filter-tag active" data-category="all" onclick="filterByCategory('all', this)">
            All</div>
          <div class="filter-tag" data-category="javascript" onclick="filterByCategory('javascript', this)">JavaScript</div>
          <div class="filter-tag" data-category="react" onclick="filterByCategory('react', this)">
            React</div>
          <div class="filter-tag" data-category="node" onclick="filterByCategory('node', this)">
            Node.js</div>
          <div class="filter-tag" data-category="ai" onclick="filterByCategory('ai', this)">AI/ML
          </div>
          <div class="filter-tag" data-category="devops" onclick="filterByCategory('devops', this)">
            DevOps</div>
          <div class="filter-tag" data-category="python" onclick="filterByCategory('python', this)">
            Python</div>
        </div>
        <div class="sort-dropdown">
          <select id="sortSelect" onchange="sortArticles()">
            <option value="newest">Newest First</option>
            <option value="oldest">Oldest First</option>
            <option value="popular">Most Popular</option>
            <option value="longest">Longest Read</option>
          </select>
        </div>
      </div>
    </div>
  </section>

  <section class="articles-section">
    <div class="container">
      <div class="loading" id="loading">
        <p>Loading articles... ⏳</p>
      </div>
      <div class="articles-grid" id="articlesGrid">
        <% blogs.forEach(function(blog) { %>
        <article class="article-card" data-category="node" data-date="<%= moment(blog.createdAt).format('YYYY-MM-DD') %>" data-popularity="850" data-readtime="<%= blog.readingMinutes %>" onclick="location.href='/blog/<%= blog.slug %>'">
          <div class="article-image">
            <img src="<%= blog.featuredImagePath %>" alt="<%= blog.title %>" />
          </div>
          <div class="article-content">
            <div class="article-meta">
              <div class="article-tags">
                <% blog.keywords.slice(0, 1).forEach(function(keyword) { %>
                <span class="article-tag"><%= keyword %></span>
                <% }); %>
              </div>
              <div class="article-date"><i class="fa-regular fa-calendar"></i> <%= moment(blog.createdAt).format(' DD MMM YYYY') %>
              </div>
            </div>
            <h3 class="article-title">
              <%= blog.title %>
            </h3>
            <p class="article-excerpt">Learn how to architect and deploy microservices that can
              handle millions of requests while maintaining code quality and developer
              productivity.</p>
            <div class="article-footer">
              <div class="read-time"><i class="fa-regular fa-clock"></i><%= blog.readingMinutes %> min read</div>
              <a href="#" class="read-more">Read More →</a>
            </div>
          </div>
        </article>
        <% }); %>
      </div>
    </div>
  </section>
</main>

<script>
    searchArticleInputElement = document.getElementById('search_articles_input');

    searchArticleInputElement.addEventListener('input', function() {
      const query = this.value.toLowerCase();
      const articles = document.querySelectorAll('.article-card');
      articles.forEach(article => {
        const title = article.querySelector('.article-title').textContent.toLowerCase();
        const excerpt = article.querySelector('.article-excerpt').textContent.toLowerCase();
        if (title.includes(query) || excerpt.includes(query)) {
          article.style.display = '';
        } else {
          article.style.display = 'none';
        }
      });
    });

    // Category Filter Function
    function filterByCategory(category, element) {
      const articles = document.querySelectorAll('.article-card');
      const filterTags = document.querySelectorAll('.filter-tag');

      filterTags.forEach(tag => tag.classList.remove('active'));
      element.classList.add('active');

      articles.forEach(article => {
        if (category === 'all' || article.getAttribute('data-category') === category) {
          article.style.display = '';
        } else {
          article.style.display = 'none';
        }
      });
    }

    // Sort Function
    function sortArticles() {
      const sortValue = document.getElementById('sortSelect').value;
      const articlesGrid = document.getElementById('articlesGrid');
      const articles = Array.from(articlesGrid.querySelectorAll('.article-card'));

      articles.sort((a, b) => {
        if (sortValue === 'newest') {
          return new Date(b.getAttribute('data-date')) - new Date(a.getAttribute('data-date'));
        } else if (sortValue === 'oldest') {
          return new Date(a.getAttribute('data-date')) - new Date(b.getAttribute('data-date'));
        } else if (sortValue === 'popular') {
          return parseInt(b.getAttribute('data-popularity')) - parseInt(a.getAttribute('data-popularity'));
        } else if (sortValue === 'longest') {
          return parseInt(b.getAttribute('data-readtime')) - parseInt(a.getAttribute('data-readtime'));
        }
      });

      articles.forEach(article => articlesGrid.appendChild(article));
    }

  // JQuery Code
  $(document).ready(function() {
    $("#sortSelect").select2({
      minimumResultsForSearch: Infinity,
    });
  });
</script>
<%- include('../includes/footer') %>